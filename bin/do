#!/bin/bash
set -euo pipefail

function build-dev-image {
  docker build --target dev --build-arg "DEV_USER_ID=$(id -u)" --build-arg "DEV_GROUP_ID=$(id -g)" "$@" .
}

if [ "${1-}" == "-v" ]; then
  shift
  build-dev-image
fi

image_id=$(build-dev-image --quiet)

exec docker run -it --rm -v "$PWD/src:/deployer/src" -v "$PWD/build:/deployer/build" "$image_id" "$@"
